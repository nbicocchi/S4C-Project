<!DOCTYPE HTML>
<html>
	<head>
		<title>Login Amministratore - App Dozza</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 30px;}
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left;}
        th { background: #eee; }
        form { display: inline; }

        img {
  				border-radius: 8px;
			}

    </style>
</head>
<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<div class="inner">
					<a href="map.html" class="image dozza"><img src="/images/thumbs/dozza.jpg" width="100%" alt="" /></a>
					<h1 style="font-size: 3em"><strong>Dozza Turism</strong></h1>
					<p>Applicazione gestita dall'amministrazione pubblica del Comune di Dozza, orientata all'ottimizzazione e gestione dei flussi turistici. </p>
				</div>
			</header>

		<!-- Main -->
			<div id="main">
                 <!-- MESSAGGI -->
                <div id="error-message" style="display:none; color:red; margin-bottom:10px;"></div>
                <div id="success-message" style="display:none; color:green; margin-bottom:10px;"></div>

                <!-- One -->
					<section class="intro">
            			<header>
                            <h1>Gestione Utenti</h1>
                            <a href="admin_dashboard.html" class="button">Torna alla dashboard</a>
                        </header>
                        <div class="content">
                            <table id="users-table">
                                <thead>
                                    <tr>
                                        <th>Email</th>
                                        <th>Ruolo</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Caricato via JS -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Two -->
					<section id="two">
						<h2>Funzionalità</h2>
						<div class="row">
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/parcheggio.jpg" style="width: 100%;"/>
								<a href="/parcheggi"><h3>Gestione Parcheggi</h3></a>
								<p>Funzione che consente di aggiungere, modificare e eliminare i parcheggi di Dozza e dintorni.</p>
							</article>
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/autobus.jpg" style="width: 100%;"/>
								<a href="linee.html"><h3>Gestione Linee Trasporto</h3></a>
								<p>Funzione che consente di aggiungere, modificare e eliminare le linee di Trasporto di Dozza e dintorni.</p>
							</article>
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/simulazione.jpg" style="width: 100%;"/>
								<a href="simulazioni.html"><h3>Gestione Simulazioni</h3></a>
								<p>Funzionalità che, in base al numero previsto di turisti, simula e suggerisce quali parcheggi aprire e quali linee di trasporto attivare per una gestione ottimale dei flussi.</p>
							</article>
							</div>
                    </section>
            </div>

    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>
    <script>
        async function loadUsers() {
            const resp = await fetch("/api/admin/users");
            if (!resp.ok) {
                showError("Errore nel caricamento degli utenti");
                return;
            }

            const users = await resp.json();
            const table = document.getElementById("users-table");
            table.innerHTML = "";

            users.forEach(u => {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td>${u.email}</td>
                    <td>${u.ruolo}</td>
                    <td>
                        <button class="button small" onclick="deleteUser(${u.id})">
                            Elimina
                        </button>
                    </td>
                `;

                table.appendChild(row);
            });
        }

        async function deleteUser(id) {
            if (!confirm("Sei sicuro di voler eliminare questo utente?")) return;

            const resp = await fetch("/api/admin/users/" + id, {
                method: "DELETE"
            });

            const data = await resp.json();

            if (data.success) {
                showSuccess("Utente eliminato");
                loadUsers();
            } else {
                showError(data.error || "Errore durante l'eliminazione");
            }
        }

        function showError(msg) {
            const box = document.getElementById("error-message");
            box.textContent = msg;
            box.style.display = "block";
        }

        function showSuccess(msg) {
            const box = document.getElementById("success-message");
            box.textContent = msg;
            box.style.display = "block";
        }

        loadUsers();
    </script>
</body>

</html>