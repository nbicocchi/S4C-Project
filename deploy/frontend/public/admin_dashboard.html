<!DOCTYPE HTML>
<html>

<head>
    <title>Dashboard Amministratore</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <style>
        
        img {
  				border-radius: 8px;
			}

    </style>
</head>
<body class="is-preload">

    <!-- Header -->
			<header id="header">
				<div class="inner">
					<a href="map.html" class="image dozza"><img src="/images/thumbs/dozza.jpg" width="100%" alt="" /></a>
					<h1 style="font-size: 3em"><strong>Dozza Turism</strong></h1>
					<p>Applicazione gestita dall'amministrazione pubblica del Comune di Dozza, orientata all'ottimizzazione e gestione dei flussi turistici. </p>
				</div>
			</header>

		<!-- Main -->
			<div id="main">

				<!-- One -->
					<section class="intro">
            			<header>
                			<h2>Aggiungi utenti al DB</h2>
            			</header>
                        <div class="content">
                            <div class="admin-actions">
                                <a href="#" class="button" onclick="logout()">Logout</a>
                                <a href="map.html" class="button">Vai alle mappe</a>
                                <a href="gestione_utenti.html" class="button">Gestione utenti</a>
                            </div>

                            <!-- Messaggio di successo nascosto -->
                            <div id="success-message" style="display:none; color: green; margin-bottom: 10px;"></div>

                            <form id="addUserForm" onsubmit="addUser(event)">
                                <div class="fields">
                                    <div class="field half">
                                        <input type="text" name="email" placeholder="Nuova email utente" required style="width: 70%; margin-top: 10px;"/>
                                    </div>
                                    <div class="field half">
                                        <input type="password" name="password" placeholder="Nuova password" required style="width: 70%; margin-top: 5px;"/>
                                    </div>
                                    <div class="field half">
                                        <select name="ruolo" style="width: 70%; margin-top: 5px;">
                                            <option value="impiegato">Impiegato</option>
                                            <option value="admin">Admin</option>
                                        </select>
                                    </div>
                                </div>
                                <ul class="actions">
                                    <li><input type="submit" value="Aggiungi utente" class="button primary" style="margin-top: 10px;"/></li>
                                </ul>
                            </form>
                        </div>
                    </section>
            <!-- Two -->
					<section id="two">
						<h2>Funzionalità</h2>
						<div class="row">
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/parcheggio.jpg" style="width: 100%;"/>
								<a href="parcheggi.html"><h3>Gestione Parcheggi</h3></a>
								<p>Funzione che consente di aggiungere, modificare e eliminare i parcheggi di Dozza e dintorni.</p>
							</article>
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/autobus.jpg" style="width: 100%;"/>
								<a href="linee.html"><h3>Gestione Linee Trasporto</h3></a>
								<p>Funzione che consente di aggiungere, modificare e eliminare le linee di Trasporto di Dozza e dintorni.</p>
							</article>
							<article class="col-6 col-12-xsmall work-item">
								<img src="/images/thumbs/simulazione.jpg" style="width: 100%;"/>
								<a href="simulazioni.html"><h3>Gestione Simulazioni</h3></a>
								<p>Funzionalità che, in base al numero previsto di turisti, simula e suggerisce quali parcheggi aprire e quali linee di trasporto attivare per una gestione ottimale dei flussi.</p>
							</article>
                            <!-- Sezione visibile solo agli admin -->
                    		<article class="col-6 col-12-xsmall work-item" id="admin-section" style="display:none">
								<img src="/images/thumbs/utenti.jpg" style="width: 100%;"/>
								<a href="gestione_utenti.html"><h3>Gestione Utenti</h3></a>
								<p>Funzione che consente agli amministratori di aggiungere, eliminare e modificare gli utenti.</p>
							</article>
						</div>
                    </section>
            </div>

    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>
    <script>
        async function logout() {
            await fetch("/api/logout", { method: "POST" });
            window.location.href = "login.html";
        }

        async function addUser(e) {
            e.preventDefault();
            const email = document.querySelector("input[name=email]").value;
            const password = document.querySelector("input[name=password]").value;
            const ruolo = document.querySelector("select[name=ruolo]").value;

            const response = await fetch("/api/admin/users", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({email, password, ruolo})
            });

            const data = await response.json();
            if (data.success) {
                const msg = document.getElementById("success-message");
                msg.textContent = "Utente aggiunto con successo!";
                msg.style.display = "block";
                document.getElementById("addUserForm").reset();
            } else {
                alert("Errore: " + data.error);
            }
        }

        async function checkAdmin() {
            const resp = await fetch("/api/userinfo");
            if (!resp.ok) return;

            const data = await resp.json();

            if (data.ruolo === "admin") {
                document.getElementById("admin-section").style.display = "";
            }
        }
        checkAdmin();
    </script>


</body>

</html>